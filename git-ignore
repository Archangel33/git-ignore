#!/bin/bash
#
# git-ignore -- A command to help with management of .gitignore files
#

version(){
    echo "git-ignore 0.0.1"
    echo
}

usage() {
    echo "usage: git ignore [options]"
    echo
    echo "Options: TBD"
    echo
}

list() {
    root=$(git rev-parse --show-toplevel)
    echo "$(git check-ignore -v $root/*)"
}

handleSubcommands(){
    local subcommand="$0"; shift
    export WORKINGDIR=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")

    if [ ! -e "$WORKINGDIR/git-ignore-$subcommand" ]; then
        usage; exit 1
    fi

    source "$WORKINGDIR/git-ignore-$subcommand"

    if [ ! type "cmd_$subcommand" ]; then
        usage; exit 1
    fi

    cmd_$subcommand "$@"
}

main(){

    if [ "$#" -lt 1 ]; then
        list; exit 0
    fi

    local VERBOSE=false

    while getopts ":l:p::" opt; do

        case "${opt}" in
            -l | --list )
                list;
                shift ;;
            -h | --help )
                usage; exit 0;;
            --version )
                version; exit 0;;
            -v | --verbose)
                VERBOSE=true; shift;;
            -- )
                echo " -- shift" ; shift;
                break ;;
            * )
                echo "should handle subcommands"
                handleSubcommands
                exit 0;;
            \? )
                list ; exit 0;;
        esac
    done
    echo "end of file"
    exit 0
}

main "$@"
